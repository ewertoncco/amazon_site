<!DOCTYPE html>
<html lang="pt-br" data-layout="topnav" data-topbar-color="light">

<head>
  <script src="/dmxAppConnect/dmxAppConnect.js"></script>
  <base href="/">
  <meta charset="utf-8" />
  <title>Amazon | Compre seu ingresso </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta content="Site de ingresso" name="description">
  <meta content="Coderthemes" name="author" />

  <!-- App favicon -->
  <link rel="shortcut icon" href="assets/images/favicon.ico">

  <link href="assets/vendor/c3/c3.min.css" rel="stylesheet" type="text/css" />

  <!-- Vendor css -->
  <link href="/assets/css/vendor.min.css" rel="stylesheet" />

  <!-- App css -->
  <link href="/assets/css/app.min.css" rel="stylesheet" id="app-style" />

  <!-- Icons css -->
  <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css" />
  <link href="assets/vendor/node-waves/waves.min.css" rel="stylesheet" type="text/css" />

  <!-- Theme Config Js -->
  <script src="/js/moment.js/2/moment-with-locales.min.js"></script>
  <script src="assets/js/config.js"></script>
  <link rel="stylesheet" href="/fontawesome5/css/all.min.css" />
  <script src="/dmxAppConnect/dmxBootstrap5Navigation/dmxBootstrap5Navigation.js" defer></script>
  <script src="/dmxAppConnect/dmxBrowser/dmxBrowser.js" defer></script>
  <script src="/dmxAppConnect/dmxFormatter/dmxFormatter.js" defer></script>
  <link rel="stylesheet" href="/dmxAppConnect/dmxNotifications/dmxNotifications.css" />
  <script src="/dmxAppConnect/dmxNotifications/dmxNotifications.js" defer></script>
  <script src="/dmxAppConnect/dmxSwiper/dmxSwiper.js" defer></script>
  <link rel="stylesheet" href="/dmxAppConnect/dmxSwiper/swiper.min.css" />
  <script src="/dmxAppConnect/dmxSwiper/swiper.min.js" defer></script>
  <script src="/dmxAppConnect/dmxTyped/dmxTyped.js" defer></script>
  <script src="/dmxAppConnect/dmxTyped/typed.min.js" defer></script>
  <link rel="stylesheet" href="/dmxAppConnect/dmxSlideshow/dmxSlideshow.css" />
  <script src="/dmxAppConnect/dmxSlideshow/dmxSlideshow.js" defer></script>
  <link rel="stylesheet" href="/dmxAppConnect/dmxSlideshow/themes/default.css" />
  <script src="/dmxAppConnect/dmxFormRepeat/dmxFormRepeat.js" defer></script>
  <script src="/dmxAppConnect/dmxDatastore/dmxDatastore.js" defer></script>
  <script src="/socket.io/socket.io.js" defer></script>
  <script src="/dmxAppConnect/dmxSockets/dmxSockets.js" defer></script>
  <script src="/dmxAppConnect/dmxStateManagement/dmxStateManagement.js" defer></script>
  <script src="/dmxAppConnect/dmxBootstrap5Modal/dmxBootstrap5Modal.js" defer></script>
  <script src="/dmxAppConnect/dmxScheduler/dmxScheduler.js" defer></script>
  <link rel="stylesheet" href="/dmxAppConnect/dmxValidator/dmxValidator.css" />
  <script src="/dmxAppConnect/dmxValidator/dmxValidator.js" defer></script>
  <script src="/dmxAppConnect/dmxPdfCreator/dmxPdfCreator.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.9/build/pdfmake.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.9/build/vfs_fonts.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/html-to-pdfmake@2.5.2/browser.min.js" defer></script>
  <script src="/dmxAppConnect/dmxRouting/dmxRouting.js" defer></script>
  <script src="/dmxAppConnect/dmxMoment/dmxMoment.js" defer></script>

  <!-- Tema personalizado - deve ser o último para sobrescrever as outras definições -->
  <link rel="stylesheet" href="/css/style.css" />

  <style>
    .navbar-nav .nav-item {
      margin: 0 5px;
    }

    .navbar-nav .nav-link {
      font-size: 0.9rem;
      font-weight: 500;
      padding: 0.5rem 1rem;
      color: #2c3e50;
      transition: all 0.3s ease;
      border-radius: 6px;
    }

    .navbar-nav .nav-link:hover {
      color: var(--bs-primary);
      background-color: rgba(var(--bs-primary-rgb), 0.1);
      transform: translateY(-1px);
    }

    .navbar-nav .nav-link.active {
      color: var(--bs-primary);
      background-color: rgba(var(--bs-primary-rgb), 0.1);
    }

    @media (max-width: 991.98px) {
      .navbar-nav .nav-item {
        margin: 5px 0;
      }

      .navbar-nav .nav-link {
        padding: 0.8rem 1rem;
      }
    }

    /* Preloader para SPA */
    .preloader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(2px);
      transition: all 0.3s ease;
    }

    .preloader.loaded {
      opacity: 0;
      visibility: hidden;
    }

    .preloader-content {
      text-align: center;
      background: rgba(255, 255, 255, 0.9);
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--bs-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Efeito de blur no conteúdo enquanto carrega */
    .content-loading {
      filter: blur(1px);
      pointer-events: none;
    }
  </style>
  <script src="/dmxAppConnect/dmxBootstrap5Alert/dmxBootstrap5Alert.js" defer></script>
</head>

<body is="dmx-app" id="homepage" spa="true" base="true">
  <dmx-serverconnect id="parcelamento" url="/api/eventos/parcelamento" dmx-param:limit="parcelamento.data.parcelamento.limit"></dmx-serverconnect>
  <dmx-session-manager id="global"></dmx-session-manager>
  <div id="app-preloader" class="preloader">
    <div class="preloader-content">
      <div class="spinner"></div>
    </div>
  </div>

  <form id="logout" is="dmx-serverconnect-form" method="post" action="/api/usuarios/logout" dmx-on:success="user.reset();browser1.goto('/index');notifies1.info('Você foi desconectado!')"></form>
  <dmx-datetime id="hoje"></dmx-datetime>

  <dmx-datastore id="datastore_carrinho"></dmx-datastore>
  <dmx-serverconnect id="eventos" url="/api/eventos/eventos"></dmx-serverconnect>
  <dmx-notifications id="notifies1"></dmx-notifications>
  <dmx-serverconnect id="user" url="/api/usuarios/user"></dmx-serverconnect>
  <dmx-value id="var_contador" dmx-bind:value="0"></dmx-value>
  <div is="dmx-browser" id="browser1"></div>

  <div class="wrapper">
    <!-- Header -->
    <header class="fixed-top bg-white shadow">
      <nav class="navbar navbar-expand-lg navbar-light py-2">
        <div class="container">
          <a class="navbar-brand" href="/" dmx-on:click="browser1.goto('/'); return false;" internal="true">
            <img src="/assets/images/logo-dark.png" alt="Logo" height="40">
          </a>
          <div class="d-flex d-lg-none align-items-center">
            <button class="btn position-relative me-2 p-1" type="button">
              <i class="fas fa-bell fa-lg"></i>
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger fs-6 fw-medium">3</span>
            </button>
            <button class="btn position-relative me-3 p-1" type="button" data-bs-toggle="modal" data-bs-target="#carrinho" dmx-show="!datastore_carrinho.data.isEmpty()">
              <i class="fas fa-shopping-cart fa-lg"></i>
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary fs-6 fw-medium">{{datastore_carrinho.data.length}}</span>
            </button>
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
              <span class="navbar-toggler-icon"></span>
            </button>
          </div>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
              <li class="nav-item">
                <a class="nav-link" href="/#evento" dmx-on:click="browser1.goto('/#evento'); return false;" dmx-class:active="browser1.location.hash == '#evento'">Eventos</a>
              </li>
              <li class="nav-item" dmx-show="!user.data.identity.isEmpty()">
                <a class="nav-link" href="/compras" dmx-on:click="browser1.goto('/compras'); return false;" dmx-class:active="browser1.location.pathname == '/compras'">Minhas compras</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/#faq" dmx-on:click="browser1.goto('/#faq'); return false;" dmx-class:active="browser1.location.hash == '#faq'">Dúvidas</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/#contato" dmx-on:click="browser1.goto('/#contato'); return false;" dmx-class:active="browser1.location.hash == '#contato'">Contato</a>
              </li>
            </ul>
            <div class="d-flex align-items-center">
              <div class="d-none d-lg-flex me-3">
                <button class="btn position-relative me-2 p-1" type="button">
                  <i class="fas fa-bell fa-lg"></i>
                  <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger fs-6 fw-medium">3</span>
                </button>
                <button class="btn position-relative me-2 p-1" type="button" data-bs-toggle="modal" data-bs-target="#carrinho" dmx-show="!datastore_carrinho.data.isEmpty()">
                  <i class="fas fa-shopping-cart fa-lg"></i>
                  <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary fs-6 fw-medium">{{datastore_carrinho.data.length}}</span>
                </button>
              </div>
              <button id="btn1" class="btn text-bg-primary" dmx-on:click="browser1.goto('/login')" dmx-show="user.data.identity.isEmpty()">Login</button>
              <div class="dropdown" dmx-show="!user.data.identity.isEmpty()">
                <button class="btn dropdown-toggle d-flex align-items-center" type="button" data-bs-toggle="dropdown">
                  <img alt="User" class="rounded-circle me-2" width="32" height="32" dmx-bind:src="user.data.user.foto||'https://images.unsplash.com/photo-1633332755192-727a05c4013d'">
                  <span class="d-none d-lg-inline">{{user.data.user.usuario_apelido}}</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li><a class="dropdown-item" href="/perfil" dmx-on:click="browser1.goto('/perfil'); return false;"><i class="fas fa-user me-2"></i>Perfil</a></li>
                  <li dmx-show="user.data.user.adm == 1"><a class="dropdown-item" href="/adm" dmx-on:click="browser1.goto('/adm'); return false;"><i class="fas fa-cogs me-2"></i>Administração</a></li>
                  <li><a class="dropdown-item" href="#" dmx-on:click="logout.submit()"><i class="fas fa-sign-out-alt me-2"></i>Sair</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <!-- Main Content -->
    <div class="container mt-5 pt-4">
      <div is="dmx-view" id="content">
        <%- await include(content, locals) %>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer bg-light mt-5">
      <div class="container py-3">
        <div class="row">
          <div class="col-12">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-center">
              <div class="mb-2 mb-md-0">
                <i class="fas fa-map-marker-alt"></i> Av. Brasil, 1500 - Centro
              </div>
              <div class="mb-2 mb-md-0">
                <i class="fas fa-phone-alt"></i> (49) 99978-7984
              </div>
              <div>
                <i class="fas fa-envelope"></i> contato@eventosapp.com
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <!-- App js -->
  <script src="/assets/vendor/node-waves/waves.min.js"></script>
  <script src="/assets/js/vendor.min.js"></script>
  <script src="/assets/js/app.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const preloader = document.getElementById('app-preloader');
      const content = document.querySelector('.container');

      // Adiciona classe de blur ao conteúdo
      if (content) content.classList.add('content-loading');

      let loadingTimeout;

      function hidePreloader() {
        preloader.classList.add('loaded');
        if (content) content.classList.remove('content-loading');
      }

      function checkAllRequestsComplete() {
        clearTimeout(loadingTimeout);

        // Verifica serverConnects que estão carregando
        const pendingRequests = Array.from(document.querySelectorAll('[is="dmx-serverconnect"]'))
          .filter(el => el.hasAttribute('url') && !el.hasAttribute('noload'))
          .map(el => dmx.app.get(el.id))
          .filter(sc => sc);

        if (pendingRequests.length === 0) {
          hidePreloader();
          return;
        }

        // Verifica se todas as requisições foram completadas
        const allComplete = pendingRequests.every(sc => 
          sc.data || sc.lastError || !sc.loading
        );

        if (allComplete) {
          setTimeout(hidePreloader, 300);
        } else {
          // Fallback para garantir que o preloader não fique preso
          loadingTimeout = setTimeout(hidePreloader, 3000);
        }
      }

      // Monitora mudanças no DOM para serverConnects
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.type === 'childList') {
            const serverConnects = mutation.target.querySelectorAll('[is="dmx-serverconnect"]');
            serverConnects.forEach(sc => {
              const component = dmx.app.get(sc.id);
              if (component && !component._preloaderBound) {
                component._preloaderBound = true;
                component.addEventListener('success', checkAllRequestsComplete);
                component.addEventListener('error', checkAllRequestsComplete);
              }
            });
          }
        });
      });

      // Observa mudanças no DOM
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });

      // Checa as requisições iniciais
      setTimeout(checkAllRequestsComplete, 500);

      // Fallback final
      window.addEventListener('load', function() {
        setTimeout(hidePreloader, 3000);
      });
      
      // Função para processar links internos
      function setupInternalLinks() {
        // Processa todos os links internos no documento
        document.querySelectorAll('a[href^="/"]').forEach(link => {
          if (!link.hasAttribute('dmx-on:click') && !link.getAttribute('href').startsWith('//') && !link.getAttribute('href').includes('://')) {
            const href = link.getAttribute('href');
            link.setAttribute('dmx-on:click', `browser1.goto('${href}'); return false;`);
            link.setAttribute('internal', 'true');
          }
        });
      }
      
      // Configura links internos após carregamento
      setupInternalLinks();
      
      // Observe navegação para configurar links em conteúdo dinâmico
      const contentObserver = new MutationObserver(setupInternalLinks);
      contentObserver.observe(document.getElementById('content'), { 
        childList: true, 
        subtree: true 
      });
    });
  </script>

</body>

</html>