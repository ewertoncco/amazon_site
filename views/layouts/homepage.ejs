<!DOCTYPE html>
<html lang="pt-br" data-layout="topnav" data-topbar-color="light">

<head>
  <script src="/dmxAppConnect/dmxAppConnect.js"></script>
  <base href="/">
  <meta charset="utf-8" />
  <title>Amazon | Compre seu ingresso </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta content="Site de ingresso" name="description">
  <meta content="Coderthemes" name="author" />

  <!-- App favicon -->
  <link rel="shortcut icon" href="assets/images/favicon.ico">

  <link href="assets/vendor/c3/c3.min.css" rel="stylesheet" type="text/css" />

  <!-- Vendor css -->
  <link href="/assets/css/vendor.min.css" rel="stylesheet" />

  <!-- App css -->
  <link href="/assets/css/app.min.css" rel="stylesheet" id="app-style" />

  <!-- Icons css -->
  <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css" />

  <!-- Theme Config Js -->
  <script src="/js/moment.js/2/moment-with-locales.min.js"></script>
  <script src="assets/js/config.js"></script>
  <link rel="stylesheet" href="/fontawesome5/css/all.min.css" />
  <script src="/dmxAppConnect/dmxBootstrap5Navigation/dmxBootstrap5Navigation.js" defer></script>
  <script src="/dmxAppConnect/dmxBrowser/dmxBrowser.js" defer></script>
  <script src="/dmxAppConnect/dmxFormatter/dmxFormatter.js" defer></script>
  <link rel="stylesheet" href="/dmxAppConnect/dmxNotifications/dmxNotifications.css" />
  <script src="/dmxAppConnect/dmxNotifications/dmxNotifications.js" defer></script>
  <script src="/dmxAppConnect/dmxSwiper/dmxSwiper.js" defer></script>
  <link rel="stylesheet" href="/dmxAppConnect/dmxSwiper/swiper.min.css" />
  <script src="/dmxAppConnect/dmxSwiper/swiper.min.js" defer></script>
  <script src="/dmxAppConnect/dmxTyped/dmxTyped.js" defer></script>
  <script src="/dmxAppConnect/dmxTyped/typed.min.js" defer></script>
  <link rel="stylesheet" href="/dmxAppConnect/dmxSlideshow/dmxSlideshow.css" />
  <script src="/dmxAppConnect/dmxSlideshow/dmxSlideshow.js" defer></script>
  <link rel="stylesheet" href="/dmxAppConnect/dmxSlideshow/themes/default.css" />
  <script src="/dmxAppConnect/dmxFormRepeat/dmxFormRepeat.js" defer></script>
  <script src="/dmxAppConnect/dmxDatastore/dmxDatastore.js" defer></script>
  <script src="/socket.io/socket.io.js" defer></script>
  <script src="/dmxAppConnect/dmxSockets/dmxSockets.js" defer></script>
  <script src="/dmxAppConnect/dmxStateManagement/dmxStateManagement.js" defer></script>
  <script src="/dmxAppConnect/dmxBootstrap5Modal/dmxBootstrap5Modal.js" defer></script>
  <script src="/dmxAppConnect/dmxScheduler/dmxScheduler.js" defer></script>
  <link rel="stylesheet" href="/dmxAppConnect/dmxValidator/dmxValidator.css" />
  <script src="/dmxAppConnect/dmxValidator/dmxValidator.js" defer></script>
  <script src="/dmxAppConnect/dmxPdfCreator/dmxPdfCreator.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.9/build/pdfmake.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.9/build/vfs_fonts.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/html-to-pdfmake@2.5.2/browser.min.js" defer></script>
  <script src="/dmxAppConnect/dmxRouting/dmxRouting.js" defer></script>
  <script src="/dmxAppConnect/dmxMoment/dmxMoment.js" defer></script>
  <script src="/formatFunctions.js" defer></script>

  <style>
    .navbar-nav .nav-item {
      margin: 0 5px;
    }

    .navbar-nav .nav-link {
      font-size: 1.1rem;
      font-weight: 500;
      padding: 0.5rem 1rem;
      color: #2c3e50;
      transition: all 0.3s ease;
      border-radius: 6px;
    }

    .navbar-nav .nav-link:hover {
      color: var(--bs-primary);
      background-color: rgba(var(--bs-primary-rgb), 0.1);
      transform: translateY(-1px);
    }

    .navbar-nav .nav-link.active {
      color: var(--bs-primary);
      background-color: rgba(var(--bs-primary-rgb), 0.1);
    }

    @media (max-width: 991.98px) {
      .navbar-nav .nav-item {
        margin: 5px 0;
      }

      .navbar-nav .nav-link {
        padding: 0.8rem 1rem;
      }
    }

    /* Preloader para SPA */
    .preloader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(2px);
      transition: all 0.3s ease;
    }

    .preloader.loaded {
      opacity: 0;
      visibility: hidden;
    }

    .preloader-content {
      text-align: center;
      background: rgba(255, 255, 255, 0.9);
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--bs-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Efeito de blur no conteúdo enquanto carrega */
    .content-loading {
      filter: blur(1px);
      pointer-events: none;
    }
  </style>
</head>

<body is="dmx-app" id="homepage" spa="true" base="true">
  <div id="app-preloader" class="preloader">
    <div class="preloader-content">
      <div class="spinner"></div>
    </div>
  </div>

  <!-- Modal do Carrinho -->
  <div class="modal fade" id="carrinho" tabindex="-1" aria-labelledby="carrinhoLabel" aria-hidden="true" is="dmx-bs5-modal">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title text-white" id="carrinhoLabel">
            <i class="fas fa-shopping-cart me-2"></i>Seu Carrinho
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body pt-0 pb-0 ps-3 pe-3" dmx-show="datastore_carrinho.data.isEmpty()">
          <div class="card-body pt-2">
            <div class="text-center p-4">
              <div class="mb-3">
                <i class="fas fa-shopping-cart fa-4x text-muted"></i>
              </div>
              <h4 class="text-muted">Seu carrinho está vazio</h4>
              <p class="mb-0">Adicione ingressos para continuar.</p>
            </div>
          </div>
        </div>
        <div class="modal-body pt-0 pb-0 ps-3 pe-3" dmx-hide="datastore_carrinho.data.isEmpty()">
          <div class="card-body pt-2">
            <div class="table-responsive">
              <table class="table table-hover m-0">
                <tbody is="dmx-repeat" id="itens_carrinho" dmx-bind:repeat="datastore_carrinho.data">
                  <tr>
                    <td class="w-70 w-75">
                      <h4 class="m-0 fw-medium">{{item_nome}}</h4>
                    </td>
                    <td class="text-center w-15 w-25">
                      <span class="text-primary">R$ </span>{{item_valor}}
                    </td>
                    <td class="text-center">
                      <button class="btn" dmx-on:click="datastore_carrinho.delete({$id: $id})">
                        <i class="fas fa-trash-alt text-danger"></i>
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td colspan="3">
                      <div class="row g-2 justify-content-start">

                        <div class="col-md-7">
                          <div class="input-group input-group-sm mb-1">
                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                            <input type="text" class="form-control" placeholder="Nome do titular" dmx-bind:value="nome" dmx-on:change="datastore_carrinho.update({$id: $id},{nome: $event.target.value})" required>
                          </div>
                        </div>
                        <div class="col-md-5">
                          <div class="input-group input-group-sm mb-1">
                            <span class="input-group-text"><i class="fas fa-id-card"></i></span>
                            <input type="text" class="form-control" placeholder="CPF do titular" dmx-bind:value="cpf" onkeyup="formatCPF(this)" dmx-on:change="datastore_carrinho.update({$id: $id},{cpf: $event.target.value})" required>
                          </div>
                        </div>
                        <div class="col-md-7">
                          <div class="input-group input-group-sm mb-1">
                            <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                            <input type="email" class="form-control" placeholder="Email do titular" dmx-bind:value="email" dmx-on:change="datastore_carrinho.update({$id: $id},{email: $event.target.value})" required>
                          </div>
                        </div>
                        <div class="col-md-5">
                          <div class="input-group input-group-sm mb-1">
                            <span class="input-group-text"><i class="fas fa-phone"></i></span>
                            <input type="text" class="form-control" placeholder="Telefone do titular" dmx-bind:value="telefone" onkeyup="formatTelefone(this)" dmx-on:change="datastore_carrinho.update({$id: $id},{telefone: $event.target.value})" required>
                          </div>
                        </div><button class="btn btn-sm text-start text-bg-light text-primary mb-1" dmx-on:click="datastore_carrinho.update({$id: $id}, {nome: user.data.user.usuario_nome, cpf: user.data.user.usuario_cpf, email: user.data.user.usuario_email, telefone: user.data.user.usuario_telefone})" dmx-show="!datastore_carrinho.data.where('cpf', user.data.user.usuario_cpf).hasItems()">
                          <i class="fas fa-user-edit me-1"></i> Completar com meus dados
                        </button>

                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="d-flex justify-content-between align-items-center border-top mt-3 mb-2 pt-3">
              <h5 class="mb-0">Total:</h5>
              <h4 class="text-primary mb-0" id="total_carrinho" dmx-bind:value="datastore_carrinho.data.sum('item_valor')">
                {{datastore_carrinho.data.sum('item_valor').formatCurrency('R$ ', ',', '.', 2)}}
              </h4>
            </div>
          </div>
        </div>
        <div class="modal-footer bg-light" dmx-hide="datastore_carrinho.data.isEmpty()">
          <button type="button" class="btn btn-info gap-1" data-bs-dismiss="modal">
            <i class="fas fa-cart-plus me-1"></i>Continuar Comprando
          </button>
          <a href="/comprar" internal="true" class="btn btn-success gap-1" dmx-on:click="carrinho.hide()">
            <i class="fas fa-credit-card me-1"></i>Finalizar Compra
          </a>
        </div>
      </div>
    </div>
  </div>

  <form id="logout" is="dmx-serverconnect-form" method="post" action="/api/usuarios/logout" dmx-on:success="user.reset();browser1.goto('/index');notifies1.info('Você foi desconectado!')"></form>
  <dmx-datetime id="hoje"></dmx-datetime>

  <dmx-datastore id="datastore_carrinho"></dmx-datastore>
  <dmx-serverconnect id="eventos" url="/api/eventos/eventos"></dmx-serverconnect>
  <dmx-notifications id="notifies1"></dmx-notifications>
  <dmx-serverconnect id="user" url="/api/usuarios/user"></dmx-serverconnect>
  <dmx-value id="var_contador" dmx-bind:value="0"></dmx-value>
  <div is="dmx-browser" id="browser1"></div>

  <div class="wrapper">
    <!-- Header -->
    <header class="fixed-top bg-white shadow">
      <nav class="navbar navbar-expand-lg navbar-light py-3">
        <div class="container">
          <a class="navbar-brand" href="/" internal="true">
            <img src="/assets/images/logo-dark.png" alt="Logo" height="40">
          </a>
          <div class="d-flex align-items-center order-lg-last">
            <button class="btn position-relative me-2 d-lg-none" type="button" data-bs-toggle="modal" data-bs-target="#carrinho" dmx-show="!datastore_carrinho.data.isEmpty()">
              <i class="fas fa-shopping-cart fa-lg"></i>
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary fs-6 fw-medium">{{datastore_carrinho.data.length}}</span>
            </button>
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
              <span class="navbar-toggler-icon"></span>
            </button>
          </div>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
              <li class="nav-item">
                <a class="nav-link" href="/#evento" dmx-class:active="browser1.location.hash == '#evento'">Eventos</a>
              </li>
              <li class="nav-item" dmx-show="!user.data.identity.isEmpty()">
                <a class="nav-link" href="/meus-ingressos" internal="true" dmx-class:active="browser1.location.pathname == '/meus-ingressos'">Meus Ingressos</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/#faq" dmx-class:active="browser1.location.hash == '#faq'">Dúvidas</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/#contato" dmx-class:active="browser1.location.hash == '#contato'">Contato</a>
              </li>
              <li class="nav-item" dmx-show="!user.data.identity.isEmpty() && user.data.user.adm == 1">
                <a class="nav-link" href="/adm" internal="true" dmx-class:active="browser1.location.pathname == '/adm'">
                  <i class="fas fa-cogs me-1"></i>Administração
                </a>
              </li>
            </ul>
            <div class="d-none d-lg-flex align-items-center">
              <button class="btn position-relative me-3 p-1" type="button" data-bs-toggle="modal" data-bs-target="#carrinho" dmx-show="!datastore_carrinho.data.isEmpty()">
                <i class="fas fa-shopping-cart fa-lg"></i>
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary fs-6 fw-medium">{{datastore_carrinho.data.length}}</span>
              </button>
              <button class="btn position-relative me-3 p-1" type="button">
                <i class="fas fa-bell fa-lg"></i>
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger fs-6 fw-medium">3</span>
              </button>
              <button id="btn1" class="btn text-bg-primary" dmx-on:click="browser1.goto('/login')" dmx-show="user.data.identity.isEmpty()">Login</button>
              <div class="dropdown" dmx-show="!user.data.identity.isEmpty()">
                <button class="btn dropdown-toggle d-flex align-items-center" type="button" data-bs-toggle="dropdown">
                  <img alt="User" class="rounded-circle me-2" width="32" height="32" dmx-bind:src="user.data.user.foto||'https://images.unsplash.com/photo-1633332755192-727a05c4013d'">
                  <span class="d-none d-lg-inline">{{user.data.user.usuario_apelido}}</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li><a class="dropdown-item" href="/perfil" internal="true"><i class="fas fa-user me-2"></i>Perfil</a></li>
                  <li dmx-show="user.data.user.adm == 1"><a class="dropdown-item" href="/adm" internal="true"><i class="fas fa-cogs me-2"></i>Administração</a></li>
                  <li><a class="dropdown-item" href="#" dmx-on:click="logout.submit()"><i class="fas fa-sign-out-alt me-2"></i>Sair</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <!-- Main Content -->
    <div class="container mt-5 pt-4">
      <div is="dmx-view" id="content">
        <%- await include(content, locals) %>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer bg-light mt-5">
      <div class="container py-3">
        <div class="row">
          <div class="col-12">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-center">
              <div class="mb-2 mb-md-0">
                <i class="fas fa-map-marker-alt"></i> Av. Brasil, 1500 - Centro
              </div>
              <div class="mb-2 mb-md-0">
                <i class="fas fa-phone-alt"></i> (49) 99978-7984
              </div>
              <div>
                <i class="fas fa-envelope"></i> contato@eventosapp.com
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <!-- App js -->
  <script src="/assets/js/vendor.min.js"></script>
  <script src="/assets/js/app.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const preloader = document.getElementById('app-preloader');
      const content = document.querySelector('.container');

      // Adiciona classe de blur ao conteúdo
      if (content) content.classList.add('content-loading');

      let loadingTimeout;

      function hidePreloader() {
        preloader.classList.add('loaded');
        if (content) content.classList.remove('content-loading');
      }

      function checkAllRequestsComplete() {
        clearTimeout(loadingTimeout);

        // Verifica serverConnects que estão carregando
        const pendingRequests = Array.from(document.querySelectorAll('[is="dmx-serverconnect"]'))
          .filter(el => el.hasAttribute('url') && !el.hasAttribute('noload'))
          .map(el => dmx.app.get(el.id))
          .filter(sc => sc);

        if (pendingRequests.length === 0) {
          hidePreloader();
          return;
        }

        // Verifica se todas as requisições foram completadas
        const allComplete = pendingRequests.every(sc => 
          sc.data || sc.lastError || !sc.loading
        );

        if (allComplete) {
          setTimeout(hidePreloader, 300);
        } else {
          // Fallback para garantir que o preloader não fique preso
          loadingTimeout = setTimeout(hidePreloader, 3000);
        }
      }

      // Monitora mudanças no DOM para serverConnects
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.type === 'childList') {
            const serverConnects = mutation.target.querySelectorAll('[is="dmx-serverconnect"]');
            serverConnects.forEach(sc => {
              const component = dmx.app.get(sc.id);
              if (component && !component._preloaderBound) {
                component._preloaderBound = true;
                component.addEventListener('success', checkAllRequestsComplete);
                component.addEventListener('error', checkAllRequestsComplete);
              }
            });
          }
        });
      });

      // Observa mudanças no DOM
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });

      // Checa as requisições iniciais
      setTimeout(checkAllRequestsComplete, 500);

      // Fallback final
      window.addEventListener('load', function() {
        setTimeout(hidePreloader, 3000);
      });
      
      // Adiciona atributo internal="true" a todos os links que apontam para rotas internas
      document.querySelectorAll('a[href^="/"]').forEach(link => {
        if (!link.hasAttribute('internal') && !link.getAttribute('href').startsWith('//') && !link.getAttribute('href').includes('://')) {
          link.setAttribute('internal', 'true');
        }
      });
    });
  </script>

</body>

</html>